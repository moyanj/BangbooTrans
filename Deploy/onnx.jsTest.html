<!DOCTYPE html>
<html>
<head>
    <title>ONNX.js 推理示例</title>
    <script src="https://cdn.jsdelivr.net/npm/onnxjs/dist/onnx.min.js"></script>
</head>
<body>
    <script>
        // 定义全局变量，模拟数据加载
        const inputLang = {
            name: "邦布",
            n_chars: 3,
            char2index: {
                "SOS": 0,
                "EOS": 1,
                "UNK": 2
                // 其他字符的 char2index 根据你的实际数据填写
            },
            index2char: {
                0: "SOS",
                1: "EOS",
                2: "UNK"
                // 其他字符的 index2char 根据你的实际数据填写
            }
        };

        const outputLang = {
            name: "中文",
            n_chars: 3,
            char2index: {
                "SOS": 0,
                "EOS": 1,
                "UNK": 2
                // 其他字符的 char2index 根据你的实际数据填写
            },
            index2char: {
                0: "SOS",
                1: "EOS",
                2: "UNK"
                // 其他字符的 index2char 根据你的实际数据填写
            }
        };

        // 模拟输入句子（假设已经预处理成索引）
        const sentence = "你的输入句子";  // 根据实际情况填写

        // 准备输入张量
        const inputIndexes = indexesFromSentence(inputLang, sentence);
        inputIndexes.push(inputLang.char2index["EOS"]);
        const inputTensor = new onnx.Tensor(new Int32Array(inputIndexes), 'int32', [inputIndexes.length, 1]);

        // 加载 ONNX 模型并执行推理
        async function loadModelAndInfer() {
            const model = await onnx.load('model.onnx');  // 替换为你的 ONNX 模型文件路径

            // 创建模型会话
            const session = await model.createSession();

            // 执行推理
            const outputMap = await session.run([inputTensor]);

            // 处理输出张量
            const outputTensor = outputMap.values().next().value;
            const outputData = outputTensor.data;

            // 根据输出数据处理结果
            console.log('模型推理结果：', decodeOutput(outputLang, outputData));
        }

        // 根据语言对象获取句子的索引数组
        function indexesFromSentence(lang, sentence) {
            const indexes = [];
            for (let char of sentence) {
                indexes.push(lang.char2index[char] || lang.char2index["UNK"]);
            }
            return indexes;
        }

        // 根据输出数据解码成字符串结果
        function decodeOutput(lang, outputData) {
            const decodedChars = [];
            for (let i = 0; i < outputData.length; i++) {
                const index = outputData[i];
                decodedChars.push(lang.index2char[index] || "UNK");
            }
            return decodedChars.join('');
        }

        // 执行模型推理
        loadModelAndInfer();
    </script>
</body>
</html>